@inherits Saritasa.NetForge.Blazor.Pages.MvvmComponentBase<Saritasa.NetForge.Mvvm.ViewModels.Details.DetailsViewModel>

<MudText Typo="Typo.h4">@ViewModel.Model.PluralName</MudText>

<MudText Typo="Typo.body1" Class="pb-5">@ViewModel.Model.Description</MudText>

<MudDataGrid T="object" ServerData="ViewModel.LoadEntityGridDataAsync" DragDropColumnReordering="true">
    <Columns>
        @{
            var orderedProperties = ViewModel.Model.Properties
                .OrderByDescending(property => property is { Name: "Id", Position: null })
                .ThenByDescending(property => property.Position.HasValue)
                .ThenBy(property => property.Position);

            foreach (var property in orderedProperties)
            {
                if (property is not { IsForeignKey: false, IsHidden: false })
                {
                    continue;
                }

                <TemplateColumn>
                    <HeaderTemplate>
                        @if (property.Description == string.Empty)
                        {
                            @(!string.IsNullOrEmpty(property.DisplayName) ? property.DisplayName : property.Name)
                        }
                        else
                        {
                            <MudTooltip Arrow="true" Placement="@Placement.Top">
                                <ChildContent>
                                    @(!string.IsNullOrEmpty(property.DisplayName) ? property.DisplayName : property.Name)
                                </ChildContent>
                                <TooltipContent>
                                    <MudText Typo="@Typo.body2">@property.Description</MudText>
                                </TooltipContent>
                            </MudTooltip>
                        }
                    </HeaderTemplate>

                    <CellTemplate>
                        @GetPropertyValue(context.Item, property.Name)
                    </CellTemplate>
                </TemplateColumn>
            }
        }
    </Columns>

    <PagerContent>
        <MudDataGridPager T="object" />
    </PagerContent>
</MudDataGrid>
