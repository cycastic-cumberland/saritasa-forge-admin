@inherits Saritasa.NetForge.Blazor.Pages.MvvmComponentBase<Saritasa.NetForge.Mvvm.ViewModels.Details.DetailsViewModel>

<MudGrid>
    <MudItem xs="6">
        <MudText Typo="Typo.h4">@ViewModel.Model.PluralName</MudText>
        <MudText Typo="Typo.body1">@ViewModel.Model.Description</MudText>
        <MudTextField T="string" @bind-Value="ViewModel.SearchString" Placeholder="Search" Immediate="true"
                      Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"
                      OnBlur="ViewModel.Search" />
    </MudItem>

    <MudItem xs="12">
        <MudDataGrid T="object" @ref="ViewModel.DataGrid" ServerData="ViewModel.LoadEntityGridDataAsync" DragDropColumnReordering="true">
            <Columns>
                @foreach (var property in ViewModel.Model.Properties)
                {
                    if (property is not { IsForeignKey: false, IsHidden: false })
                    {
                        continue;
                    }

                    <TemplateColumn>
                        <HeaderTemplate>
                            @{
                                var displayName = !string.IsNullOrEmpty(property.DisplayName)
                                    ? property.DisplayName
                                    : property.Name;

                                if (property.Description == string.Empty)
                                {
                                    @displayName
                                }
                                else
                                {
                                    <MudTooltip Arrow="true" Placement="@Placement.Top">
                                        <ChildContent>
                                            @displayName
                                        </ChildContent>
                                        <TooltipContent>
                                            <MudText Typo="@Typo.body2">@property.Description</MudText>
                                        </TooltipContent>
                                    </MudTooltip>
                                }
                            }
                        </HeaderTemplate>

                        <CellTemplate>
                            @GetPropertyValue(context.Item, property.Name)
                        </CellTemplate>
                    </TemplateColumn>
                }
            </Columns>

            <PagerContent>
                <MudDataGridPager T="object"/>
            </PagerContent>
        </MudDataGrid>
    </MudItem>
</MudGrid>
