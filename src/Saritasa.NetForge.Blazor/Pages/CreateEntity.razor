@using Saritasa.NetForge.Blazor.Controls
@using Saritasa.NetForge.Domain.Entities.Options
@using Saritasa.NetForge.Mvvm.Navigation

@inject AdminOptions AdminOptions
@inject INavigationService NavigationService;
@inherits MvvmComponentBase<Saritasa.NetForge.Mvvm.ViewModels.CreateEntity.CreateEntityViewModel>

@if (ViewModel.IsEntityExists)
{
    <MudBreadcrumbs Items="breadcrumbItems"></MudBreadcrumbs>

    var title = $"Creation of {ViewModel.Model.DisplayName}";
    <PageTitle>@title</PageTitle>
    <MudText Typo="Typo.h4">@title</MudText>

    <EditForm Model="ViewModel.EntityModel" OnValidSubmit="ViewModel.CreateEntityAsync">
        @{
            var properties = ViewModel.Model.Properties
            .Where(property => property is { IsNavigation: false, IsCalculatedProperty: false });

            foreach (var property in properties)
            {
                var propertyType = ViewModel.Model.ClrType?.GetProperty(property.Name)?.PropertyType;
                if (propertyType == typeof(DateTime))
                {
                    <MudTextField T="string"
                                  Label="@property.Name"
                                  Placeholder="@propertyType.ToString()"
                                  InputType="InputType.Date"
                                  TextChanged="value => ViewModel.HandleInputChange(value, property.Name)">
                    </MudTextField>
                }
                else if (propertyType == typeof(bool))
                {
                    <MudCheckBox T="bool"
                                 Label="@property.Name"
                                 CheckedChanged="value => ViewModel.HandleInputChange(value!, property.Name)">
                    </MudCheckBox>
                }
                else
                {
                    <MudTextField T="string"
                                  Label="@property.Name"
                                  Placeholder="@propertyType?.ToString()"
                                  TextChanged="value => ViewModel.HandleInputChange(value, property.Name)">
                    </MudTextField>
                }
            }
        }

        <MudButton ButtonType="ButtonType.Submit">Save</MudButton>
        <MudButton OnClick="NavigateToEntityDetails">Cancel</MudButton>
    </EditForm>
}
else
{
    <NotFound />
}
