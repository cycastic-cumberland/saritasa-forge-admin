@using Saritasa.NetForge.Blazor.Controls
@using Saritasa.NetForge.Domain.Entities.Options

@inject AdminOptions AdminOptions
@inherits MvvmComponentBase<Saritasa.NetForge.Mvvm.ViewModels.CreateEntity.CreateEntityViewModel>

@if (ViewModel.IsEntityExists)
{
    <MudBreadcrumbs Items="breadcrumbItems"></MudBreadcrumbs>

    var title = $"Creation of {ViewModel.Model.DisplayName}";
    <PageTitle>@title</PageTitle>
    <MudText Typo="Typo.h4">@title</MudText>

    <EditForm Model="ViewModel.EntityModel" OnValidSubmit="ViewModel.CreateEntityAsync">
        @foreach (var property in ViewModel.Model.Properties.Where(property => !property.IsNavigation))
        {
            var propertyType = ViewModel.Model.ClrType?.GetProperty(property.Name)?.PropertyType;
            if (propertyType == typeof(DateTime))
            {
                <MudTextField T="string"
                              Label="@property.Name"
                              Placeholder="@propertyType.ToString()"
                              InputType="InputType.Date"
                              TextChanged="value => ViewModel.HandleInputChange(value, property.Name)"></MudTextField>
            }
            else
            {
                <MudTextField T="string"
                              Label="@property.Name"
                              Placeholder="@propertyType?.ToString()"
                              TextChanged="value => ViewModel.HandleInputChange(value, property.Name)"></MudTextField>
            }
        }

        <MudButton ButtonType="ButtonType.Submit">Create</MudButton>
    </EditForm>
}
else
{
    <NotFound />
}
